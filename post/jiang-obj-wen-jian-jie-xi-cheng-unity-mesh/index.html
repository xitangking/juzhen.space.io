<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>将 obj 文件解析成 unity mesh | 矩阵·空间</title>
<meta name="description" content="juzhen.space">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://juzhen.space/favicon.ico?v=1556304089200">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://juzhen.space/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-139144367-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-139144367-1');
</script>


  </head>
  <body>
  
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://juzhen.space">矩阵·空间</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                首页
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>将 obj 文件解析成 unity mesh</h1>
            <p class="article-meta">
              2017-12-07
              
            </p>
            
            <div class="post-content">
              <p>obj 文件是三维模型中一种经典的通用的文件格式，他记录下了三维模型中的大部分必要信息，下面将尝试在 unity 中将 obj 解析成 unity 的 mesh 网格。</p>
<!-- more -->
<h4 id="了解obj文件结构">了解obj文件结构</h4>
<p>既然要解析obj文件，那么在这之前我们当然要对obj文件的结构有所了解，下面我们就了解一下一个 unity 中经典的 cube 的 obj 格式会是怎样。</p>
<pre><code>o Cube // 网格名称
v 0.500000 -0.500000 0.500000  // 顶点数据 ： v 字后面跟的就是顶点的局部坐标 x,y,z 的值
v -0.500000 -0.500000 0.500000
v 0.500000 0.500000 0.500000
v -0.500000 0.500000 0.500000
v 0.500000 0.500000 -0.500000
v -0.500000 0.500000 -0.500000
v 0.500000 -0.500000 -0.500000
v -0.500000 -0.500000 -0.500000
v 0.500000 0.500000 0.500000
v -0.500000 0.500000 0.500000
v 0.500000 0.500000 -0.500000
v -0.500000 0.500000 -0.500000
v 0.500000 -0.500000 -0.500000
v 0.500000 -0.500000 0.500000
v -0.500000 -0.500000 0.500000
v -0.500000 -0.500000 -0.500000
v -0.500000 -0.500000 0.500000
v -0.500000 0.500000 0.500000
v -0.500000 0.500000 -0.500000
v -0.500000 -0.500000 -0.500000
v 0.500000 -0.500000 -0.500000
v 0.500000 0.500000 -0.500000
v 0.500000 0.500000 0.500000
v 0.500000 -0.500000 0.500000

vn 0.000000 0.000000 1.000000  // 法线数据
vn 0.000000 0.000000 1.000000
vn 0.000000 0.000000 1.000000
vn 0.000000 0.000000 1.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 1.000000 0.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 0.000000 -1.000000
vn 0.000000 -1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn 0.000000 -1.000000 0.000000
vn -1.000000 0.000000 0.000000
vn -1.000000 0.000000 0.000000
vn -1.000000 0.000000 0.000000
vn -1.000000 0.000000 0.000000
vn 1.000000 0.000000 0.000000
vn 1.000000 0.000000 0.000000
vn 1.000000 0.000000 0.000000
vn 1.000000 0.000000 0.000000

vt 0.000000 0.000000  // UV数据
vt 1.000000 0.000000
vt 0.000000 1.000000
vt 1.000000 1.000000
vt 0.000000 1.000000
vt 1.000000 1.000000
vt 0.000000 1.000000
vt 1.000000 1.000000
vt 0.000000 0.000000
vt 1.000000 0.000000
vt 0.000000 0.000000
vt 1.000000 0.000000
vt 0.000000 0.000000
vt 0.000000 1.000000
vt 1.000000 1.000000
vt 1.000000 0.000000
vt 0.000000 0.000000
vt 0.000000 1.000000
vt 1.000000 1.000000
vt 1.000000 0.000000
vt 0.000000 0.000000
vt 0.000000 1.000000
vt 1.000000 1.000000
vt 1.000000 0.000000

g Default-Material  // 材质名称
usemtl Default-Material  // 使用的材质
usemap Default-Material  // 使用的贴图

f 1/1/1 3/3/3 4/4/4  // 三角形数据 - 顶点索引/UV索引/法线索引
f 1/1/1 4/4/4 2/2/2
f 9/9/9 5/5/5 6/6/6
f 9/9/9 6/6/6 10/10/10
f 11/11/11 7/7/7 8/8/8
f 11/11/11 8/8/8 12/12/12
f 13/13/13 14/14/14 15/15/15
f 13/13/13 15/15/15 16/16/16
f 17/17/17 18/18/18 19/19/19
f 17/17/17 19/19/19 20/20/20
f 21/21/21 22/22/22 23/23/23
f 21/21/21 23/23/23 24/24/24

</code></pre>
<h4 id="解析成mesh">解析成mesh</h4>
<p>了解了obj文件的结构就会发现，解析它其实挺简单的，只需要根据每一行的前缀确定后面的数据到底属于哪一种类型，然后将它分割保存起来，最后赋值给mesh中的对应属性即可。</p>
<pre><code class="language-csharp">using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using System.IO;

public class ObjParser{

    public static Mesh Parse(string url)
    {
        Mesh mesh = new Mesh();

        List&lt;Vector3&gt; vts = new List&lt;Vector3&gt;();
        List&lt;Vector2&gt; uvs = new List&lt;Vector2&gt;();
        List&lt;Vector3&gt; normals = new List&lt;Vector3&gt;();
        List&lt;int&gt; tris = new List&lt;int&gt;();


        StreamReader sr = new StreamReader(url);

        while(!sr.EndOfStream)
        {
            string line = sr.ReadLine();
            string[] split = line.Split(' ');

            switch(split[0])
            {
                case &quot;o&quot;:
                    mesh.name = split[1];
                    break;

                case &quot;v&quot;:
                    {
                        float x = float.Parse(split[1]);
                        float y = float.Parse(split[2]);
                        float z = float.Parse(split[3]);

                        vts.Add(new Vector3(x, y, z));
                    }
                    break;
                case &quot;vn&quot;:
                    {
                        float x = float.Parse(split[1]);
                        float y = float.Parse(split[2]);
                        float z = float.Parse(split[3]);

                        normals.Add(new Vector3(x, y, z));
                    }
                    break;

                case &quot;vt&quot;:
                    {
                        float x = float.Parse(split[1]);
                        float y = float.Parse(split[2]);

                        uvs.Add(new Vector2(x, y));
                    }
                    break;

                case &quot;f&quot;:
                    {
                        for (int i = 1; i &lt; split.Length; ++i)
                        {
                            string[] sp = split[i].Split('/');
                            tris.Add(int.Parse(sp[0]) - 1);
                        }
                    }
                    break;

                default:

                    break;
            }
        }

        mesh.vertices = vts.ToArray();
        mesh.uv = uvs.ToArray();
        mesh.normals = normals.ToArray();
        mesh.triangles = tris.ToArray();

        return mesh;
    }

}
</code></pre>

            </div>
          </article>
        </div>
        <div class="paper" data-aos="fade-in">
          
            <div class="next-post">
              <div class="next">
                下一篇
              </div>
              <a href="https://juzhen.space/post/Unity application starts up automatically">
                <h3 class="post-title">
                  unity应用开机自启
                </h3>
              </a>
            </div>
          
        </div>
        
          
            <div class="paper" data-aos="fade-in">
              <div id="gitalk-container"></div>
            </div>
          

          
        
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img src="https://juzhen.space/images/avatar.png?v=1556304089200" class="no-responsive avatar">
    <div class="text-muted">juzhen.space</div>
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      最新文章
    </div>
    <div class="row">
      <ul>
        
          
            <li>
              <a href="https://juzhen.space/post/zuo-er-ting-feng-arts-ji-hua-di-yi-zhou">左耳听风ARTS计划 -- 第一周</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/htc-vive-wave-gai-lan">HTC VIVE Wave 概览</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/da-shu-ju-de-shua-ti-bi-bei">大数据的刷题必备</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/bo-li-xiao-guo-de-shader-xiao-guo">玻璃效果的 Shader 效果</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/bit-operation">位运算的刷题应用</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/laravel-huan-jing-da-jian-apache-he-nginx">Laravel 环境搭建 Apache 和 Nginx</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/git-webhooks-shi-xian-zi-dong-la-qu-dai-ma">git webhooks 实现自动拉取代码</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/jiang-obj-wen-jian-jie-xi-cheng-unity-mesh">将 obj 文件解析成 unity mesh</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/Unity application starts up automatically">unity应用开机自启</a>
            </li>
          
        
          
            <li>
              <a href="https://juzhen.space/post/markdown-guide">Markdown指南</a>
            </li>
          
        
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      标签列表
    </div>
    <div class="row">
      
        <a href="https://juzhen.space/tag/左耳听风ARTS" class="badge secondary">
          左耳听风ARTS
        </a>
      
        <a href="https://juzhen.space/tag/bigdata" class="badge secondary">
          bigdata
        </a>
      
        <a href="https://juzhen.space/tag/刷题" class="badge secondary">
          刷题
        </a>
      
        <a href="https://juzhen.space/tag/bit operation" class="badge ">
          bit operation
        </a>
      
    </div>
  </div>
  <div class="paper">
    Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  </div>
</div>


    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

</script>


  
  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '80729f653146f76d242b',
        clientSecret: 'e6dc0eee88151d2707fe6b81c1d4f5d388c0670f',
        repo: 'xitangking.github.io',
        owner: 'xitangking',
        admin: ['xitangking'],
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
